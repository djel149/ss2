corrected and copied code from pervious .NET project, for playing around with
